<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Iniciar SesiÃ³n - Smoothies Naturales</title>
  <link rel="stylesheet" href="css/style.css"/>

  <style>
    body{
      background:#f8f9fa;
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display:flex;
      flex-direction:column;
      min-height:100vh;
      margin:0;
      color:#333
    }
    header{background:#fff;box-shadow:0 2px 5px rgba(0,0,0,0.1)}
    .navbar{display:flex;justify-content:space-between;align-items:center;padding:1rem 2rem}
    .logo{font-weight:700;font-size:1.3rem;color:#2e7d32}
    .nav-links{list-style:none;display:flex;gap:1.5rem;margin:0;padding:0}
    .nav-links a{text-decoration:none;color:#333;font-weight:500}
    .nav-links a.active{color:#2e7d32;font-weight:600}
    .auth{flex:1;display:flex;justify-content:center;align-items:center;padding:2rem}
    .auth-card{background:#fff;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.1);padding:2.5rem 3rem;width:100%;max-width:380px;text-align:center}
    .auth-title{font-size:1.5rem;font-weight:800;margin-bottom:1.8rem;color:#222}
    .auth-form{display:flex;flex-direction:column;gap:1rem}
    .form-field{text-align:left}
    label{display:block;font-weight:600;margin-bottom:.4rem;color:#444}
    input{width:100%;padding:10px 12px;border:1px solid #ccc;border-radius:8px;outline:none;font-size:1rem;transition:border .2s ease}
    input:focus{border-color:#2e7d32;box-shadow:0 0 0 1px #2e7d32}
    .auth-submit{background:#2e7d32;color:#fff;border:none;border-radius:8px;padding:10px;font-weight:700;font-size:1rem;cursor:pointer;transition:background .2s ease}
    .auth-submit:hover{background:#256b29}
    .auth-alt{margin-top:1.2rem;font-size:.9rem;color:#555}
    .auth-alt a{color:#2e7d32;font-weight:700;text-decoration:none}
    .auth-alt a:hover{text-decoration:underline}
    footer{background:#fff;text-align:center;padding:1rem 0;border-top:1px solid #eee;color:#555;font-size:.9rem}
    .nav-user-badge{font-weight:600;color:#2e7d32}
    .nav-sep{opacity:.35;margin:0 .35rem}

    /* --- MODAL BONITO DE BIENVENIDA --- */
    .login-success-overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.55);
      display:flex;
      justify-content:center;
      align-items:center;
      z-index:999;
    }
    .login-success-overlay.hidden{display:none;}
    .login-success-card{
      background:#fff;
      border-radius:18px;
      padding:2.3rem 2.6rem;
      width:90%;
      max-width:360px;
      text-align:center;
      box-shadow:0 18px 40px rgba(15,23,42,.35);
    }
    .login-success-icon{
      font-size:2rem;
      margin-bottom:.7rem;
    }
    .login-success-title{
      font-size:1.4rem;
      font-weight:700;
      color:#166534;
      margin:0 0 .35rem;
    }
    .login-success-subtitle{
      font-size:.95rem;
      color:#374151;
      margin:0 0 1.4rem;
    }
    .login-success-btn{
      background:#15803d;
      color:#fff;
      border:none;
      padding:.55rem 1.6rem;
      border-radius:999px;
      font-weight:600;
      cursor:pointer;
      font-size:.95rem;
    }
    .login-success-btn:hover{
      background:#166534;
    }
  </style>
</head>

<body>

  <!-- Header -->
  <header>
    <div class="container">
      <nav class="navbar">
        <div class="logo">Natural Power</div>
        <ul class="nav-links">
          <li><a href="index.html">Inicio</a></li>
          <li><a href="productos.html">MenÃº</a></li>

          <li><a href="perfil.html" id="nav-profile" style="display:none;">Perfil</a></li>

          <li>
            <span id="nav-user-email" class="nav-user-badge" style="display:none;"></span>
            <span class="nav-sep" id="nav-sep" style="display:none;">Â·</span>
            <a href="login.html" id="nav-login" class="active">Iniciar SesiÃ³n</a>
            <a href="#" id="nav-logout" style="display:none;">Salir</a>
          </li>
          <li><a href="carrito.html">ðŸ›’ Carrito</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Login -->
  <section class="auth">
    <div class="auth-card">
      <h2 class="auth-title">Iniciar SesiÃ³n</h2>

      <form id="form-login" class="auth-form" novalidate>
        <div class="form-field">
          <label for="email">Correo</label>
          <input type="email" id="email" name="email" placeholder="tu@correo.com" required />
        </div>

        <div class="form-field">
          <label for="password">ContraseÃ±a</label>
          <input type="password" id="password" name="password" placeholder="Tu contraseÃ±a" required />
        </div>

        <button type="submit" class="auth-submit">Entrar</button>
      </form>

      <p class="auth-alt">
        Â¿No tienes cuenta?
        <a href="registrar.html">RegÃ­strate</a>
      </p>
    </div>
  </section>

  <footer>
    <div class="container">
      <p>&copy; 2025 Natural Power. Todos los derechos reservados.</p>
    </div>
  </footer>

  <!-- MODAL DE BIENVENIDA -->
  <div id="login-success-modal" class="login-success-overlay hidden">
    <div class="login-success-card">
      <div class="login-success-icon">âœ¨</div>
      <h2 class="login-success-title">Inicio de sesiÃ³n exitoso</h2>
      <p class="login-success-subtitle">
        Â¡Bienvenido, <span id="login-success-email"></span>!
      </p>
      <button id="login-success-accept" class="login-success-btn">Aceptar</button>
    </div>
  </div>

  <script src="js/auth.js"></script>

  <script>
    // pintar navbar
    function renderSessionUI(){
      const u = Auth.currentUser();
      const login = document.getElementById('nav-login');
      const logout = document.getElementById('nav-logout');
      const emailBadge = document.getElementById('nav-user-email');
      const sep = document.getElementById('nav-sep');
      const profile = document.getElementById('nav-profile');

      if (u) {
        emailBadge.textContent = u.email;
        emailBadge.style.display = 'inline';
        sep.style.display = 'inline';
        login.style.display = 'none';
        logout.style.display = 'inline';
        if (profile) profile.style.display = 'inline';
      } else {
        emailBadge.style.display = 'none';
        sep.style.display = 'none';
        login.style.display = 'inline';
        logout.style.display = 'none';
        if (profile) profile.style.display = 'none';
      }
    }

    document.getElementById('nav-logout').addEventListener('click', async (e)=>{
      e.preventDefault();
      await Auth.logout();
      renderSessionUI();
    });

    // --- MODAL BONITO ---
    function showLoginSuccess(email){
      document.getElementById("login-success-email").textContent = email;
      document.getElementById("login-success-modal").classList.remove("hidden");
    }

    document.getElementById("login-success-accept").addEventListener("click", ()=>{
      document.getElementById("login-success-modal").classList.add("hidden");
      window.location.href = "index.html";
    });

    // LOGIN
    document.getElementById('form-login').addEventListener('submit', async (e) => {
      e.preventDefault();

      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();

      if (!email || !password)
        return alert('Completa correo y contraseÃ±a.');

      const { ok, user, error } = await Auth.login({ email, password });

      if (!ok) return alert(error || 'No fue posible iniciar sesiÃ³n.');

      // Mostrar modal de bienvenida
      showLoginSuccess(user.email);
    });

    document.addEventListener('DOMContentLoaded', renderSessionUI);
  </script>

</body>
</html>
